{% extends "main.html" %}
{% block content %}
{% include "header.html" %}
<style>

</style>
<div id="viewer" class="container" style="min-height: 70vh;padding-top:40px;">
  <div class="row" style="margin-top:40px;">
    <!-- IF NO QUERY -->
    <div v-if="!query" class="col-sm-12 mb-5">
      <div v-if="!registered" class="jumbotron message w-100 padding20 text-center text-muted">
        <h3>Register this schema?</h3>
        <button v-if="!slugRegistered" data-toggle="modal" data-target="#registration" class="btn themeButton text-light" > Register Now</button>
      </div>
      <div class="padding20">
        <a @click="switchView()" class="bold mainTextDark pointer float-right mb-4">
          Toggle View <i class="fas fa-retweet"></i>
        </a>
      </div>
      <div v-if="viewAlphabetical">
        <form class="col-sm-12 pl-0">
          <div class="input-group mb-2 col-sm-12 col-md-6">
            <div class="input-group-prepend">
              <div class="input-group-text">Quick Search</div>
            </div>
            <input type="text" v-model='searchQuery' class="form-control" id="inlineFormInputGroup" placeholder="Enter text here">
          </div>
          <div class="row w-100">
            <div class="col-sm-12 col-md-6 p-4">
              <ul >
                <li v-if="searchResults.length" class="mainTextDark bold" style="list-style:none;">
                  Classes
                </li>
                <li v-for='item in searchResults' >
                  <a :href='"./"+item["rdfs:label"]' v-text='item["name"]'></a>
                </li>
              </ul>
            </div>
            <div class="col-sm-12 col-md-6 p-4">
              <ul >
                <li v-if="searchResultsProps.length" class="mainTextLight bold" style="list-style:none;">
                  Properties
                </li>
                <li v-for='item in searchResultsProps'>
                  <a :href='"./"+item["rdfs:label"]' v-text='item["name"]'></a>
                </li>
              </ul>
            </div>
          </div>
        </form>
        <h1 class="logoText">Alphabetical</h1>
        <!-- <div id="canvas2"></div> -->
        <ul class="pagination" style="overflow-x: scroll;">
          <li class="page-link" v-for="(item,i) in availableClassesNames">
            <a :href="'#'+item.group" v-text="item.group"></a>
          </li>
        </ul>
        <ul class="list-group">
          <li class="list-group-item list-group-item-action" v-for="(item,i) in availableClassesNames">
            <h1 :id="item.group" class="text-muted" v-text="item.group "></h1>
            <ul>
              <li v-for="def in item.children">
                <a class="goLink" :href="'./'+def" v-text="def"></a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
      <div v-else>
        <h1 class="logoText">Hierarchical</h1>
        <ul class="pagination">
          <li class="d-inline bg-0" style="width:20px; height:20px" >
          </li>
          <li class="d-inline bg-1" style="width:20px; height:20px" >
          </li>
          <li class="d-inline bg-2" style="width:20px; height:20px" >
          </li>
          <li class="d-inline bg-3" style="width:20px; height:20px" >
          </li>
          <li class="d-inline bg-4" style="width:20px; height:20px" >
          </li>
          <li class="d-inline bg-5" style="width:20px; height:20px" >
          </li>
          <li class="d-inline bg-6" style="width:20px; height:20px" >
          </li>
          <li class="d-inline bg-7" style="width:20px; height:20px" >
          </li>
          <li class="d-inline bg-8" style="width:20px; height:20px" >
          </li>
          <li class="d-inline bg-9" style="width:20px; height:20px" >
          </li>
          <li class="d-inline bg-10" style="width:20px; height:20px" >
          </li>
        </ul>
        <ul class="tree">
          <li>
            <a class="text-0 goLink" :href="'./'+rootNode" v-text="rootNode" ></a>
            <ul>
              <li v-for="item in getNeighbors(rootNode)">
                <a class="text-1 goLink" :href="'./'+item" v-text="item"></a>
                <ul>
                  <li v-for="item2 in getNeighbors(item)">
                    <a class="text-2 goLink" :href="'./'+item2" v-text="item2"></a>
                    <ul>
                      <li v-for="item3 in getNeighbors(item2)">
                        <a class="text-3 goLink" :href="'./'+item3" v-text="item3"></a>
                        <ul>
                          <li v-for="item4 in getNeighbors(item3)">
                            <a class="text-4 goLink" :href="'./'+item4" v-text="item4"></a>
                            <ul>
                              <li v-for="item5 in getNeighbors(item4)">
                                <a class="text-5 goLink" :href="'./'+item5" v-text="item5"></a>
                                <ul>
                                  <li v-for="item6 in getNeighbors(item5)">
                                    <a class="text-6 goLink" :href="'./'+item6" v-text="item6"></a>
                                    <ul>
                                      <li v-for="item7 in getNeighbors(item6)">
                                        <a class="text-7 goLink" :href="'./'+item7" v-text="item7"></a>
                                        <ul>
                                          <li v-for="item8 in getNeighbors(item7)">
                                            <a class="text-8 goLink" :href="'./'+item8" v-text="item8"></a>
                                            <ul>
                                              <li v-for="item9 in getNeighbors(item8)">
                                                <a class="text-9 goLink" :href="'./'+item9" v-text="item9"></a>
                                                <ul>
                                                  <li v-for="item10 in getNeighbors(item9)">
                                                    <a class="text-10 goLink" :href="'./'+item10" v-text="item10"></a>
                                                  </li>
                                                </ul>
                                              </li>
                                            </ul>
                                          </li>
                                        </ul>
                                      </li>
                                    </ul>
                                  </li>
                                </ul>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
    <div v-else class="col-sm-12">
      <div id="canvas" class="d-none d-sm-none d-md-block"></div>
      <div class="p-1" v-if="query">
        <ul class="nav nav-justified">
          <li class="nav-item">
            <a class="nav-link mainTextDark" :href="RemoveLastDirectoryPartOf(window.location.href)"><i class="fas fa-chevron-left"></i> Back</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle mainTextDark" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Jump To</a>
            <div class="dropdown-menu">
              <a class="nav-link mainTextDark" v-for="item in parentDisplayResults.slice().reverse()" :href="'#'+removePrefix(item)">
                <span v-text="removePrefix(item)"></span>
              </a>
              <a class="nav-link pointer mainTextDark" href="#bottom" >
                 More...
              </a>
            </div>
          </li>
          <li class="nav-item ">
            <a class="nav-link mainTextDark pointer" data-toggle="modal" data-target="#changeClass"><i class="fas fa-window-restore"></i> Change Class Viewed</a>
          </li>
        </ul>
      </div>
      <!-- MAIN CLASS BOX -->
      <div class="jumbotron message" v-if='schemaClass'>
        <div >
          <a v-if="!showGraph" @click="toggleGraph" class="d-none d-sm-none d-md-block mainTextDark bold float-right pointer" ><i class="fas fa-draw-polygon"></i> View Graph</a>
          <h1 class="mainTextDark bold" v-if='schemaClass' :id='schemaClass' v-text='schemaClass'></h1>
          <template v-if='schemaClass'>
            <ol>
              <li v-for="path in getPaths(classInfo)">
                <span v-for="(item,index) in path">
                  <a :class="[ index !== path.length-1 ? 'text-muted' : 'mainTextDark']" class="font-weight-bold small" :href="'./'+item" v-text="item"></a>
                  <span v-if="index !== path.length-1">&nbsp;<i class="fas fa-caret-right mainTextDark"></i>&nbsp;</span>
                </span>
              </li>
            </ol>
          </template>
          <template v-else>
            <span v-if="subclass">
              <a class="mainTextLight font-weight-bold" :href="'./'+subclass" v-text='subclass'></a>
              &gt;
            </span>
            <a class="mainTextDark font-weight-bold" :href="'./'+schemaClass" v-text='schemaClass'></a>
          </template>
          <template v-if="schemaClass">
            <p v-html="classInfo['description'] || 'No Description Provided'" class="padding20 description mainTextDark"></p>
          </template>
        </div>
      </div>
      <!-- MAIN CLASS PROPERTIES -->
      <h1 class="mainTextDark bold" v-if='property' v-text='property'></h1>
      <div class="resultsTabFull mt-3 p-3 mainBackDark text-light">
        <span v-if='schemaClass'>Properties of</span> <h3 v-text='schemaClass' class='d-inline'></h3>
      </div>
      <table class="table  table-striped-main" style="margin-bottom: 40px;border-left:5px solid var(--main);">
      <tbody>
        <tr v-for="(item,i) in getPropertiesFor(classInfo)">
          <td >
            <a class="font-weight-bold" :href='"./"+item.name'>
              <span v-html='item.name'></span>
            </a>
            <small v-html='item.description || "No description provided"'></small>
            <hr />
            <small class="mainTextDark bold">Expected Type: </small>
            <template v-for="(type,i) in item.value_types">
              <a :href="generateLink(type)">
                <small >
                  <span v-html='type'></span>
                </small>
                <i v-if="generateLink(type)[0] !== '.'" class="fas small fa-external-link-alt"></i>
              </a>
              <span v-if="i !== getType(item).length-1">, </span>
            </template>
          </td>
        </tr>
      </tbody>
    </table>
    <!-- <template v-if="!classInfo.props">
      <div class="text-center alert alert-secondary text-muted padding20" style="margin-bottom: 40px">
        <i class="fas fa-exclamation-circle"></i>
        This class has no properties of it's own
      </div>
    </template> -->
    <div class="row" v-if='propertyInfo["@id"]'>
      <div class="col-sm-6">
        <ul class="list-group" style="max-width: 50vw;">
          <li class="list-group-item mainBackLight text-light font-weight-bold">
            Used on these types
          </li>
          <li class="list-group-item" v-for="(item,i) in usedOnTheseTypes">
              <a :href="'./'+removePrefix(item)" v-text="removePrefix(item)"></a>
          </li>
        </ul>
      </div>
      <div class="col-sm-6">
        <ul class="list-group" style="max-width: 50vw;">
          <li class="list-group-item mainBackLight text-light font-weight-bold">
            Values expected to be one of these types
          </li>
          <li class="list-group-item" v-for="(item,i) in rangeIncludes">
              <a :href="'./'+removePrefix(item)" v-text="removePrefix(item)"></a>
          </li>
        </ul>
      </div>
    </div>

    <!-- PARENT CLASS PROPERTIES -->
    <template v-if='userSchemaParents.length' v-for="item in userSchemaParents">
      <div class="resultsTabFull mt-3 p-3 mainBackLight text-light">
        <span v-text='item'></span>
      </div>
    </template>
  <!-- <span v-if="parentClassesAndProps.length" v-for="(parent,i) in parentClassesAndProps">
    <div :id='parent["className"]' class="resultsTabFull mt-3 p-3 mainBackLight text-light">
      Properties of <h3 v-text='parent["className"]' class='d-inline'></h3> <small><a class='text-light' :href='"#"+parent["className"]'><i class="fas fa-link"></i></a></small>
    </div>
    <table v-if="parent['props'].length" class="table  table-striped-sec" style="margin-bottom: 40px; border-left:5px solid var(--sec);">
      <tbody>
        <tr v-for="item in parent['props']">
          <td >
            <a class="font-weight-bold" :href='"./"+getTitle(item)'>
              <span v-html=getTitle(item)></span>
            </a>
            <small v-html=getDescription(item) class=""></small>
            <hr />
            <small class="mainTextLight bold">Expected Type: </small>
            <template v-for="(type,i) in getType(item)">
              <a :href="generateLink(type)" >
                <small>
                  <span v-html='type'></span>
                </small>
                <i v-if="generateLink(type)[0] !== '.'" class="fas small fa-external-link-alt"></i>
              </a>
              <span v-if="i !== getType(item).length-1">, </span>
            </template>
          </td>
        </tr>
      </tbody>
    </table>
  </span>

  <template v-else>
    <div class="text-center alert alert-secondary text-muted  padding20" style="margin-bottom: 40px">
      <i class="fas fa-exclamation-circle"></i>
      This class has no properties of it's own
    </div>
  </template> -->

  </div>
    <div class="col-sm-3">

    </div>
    <div id="bottom" v-if='schemaClass' class="jumbotron text-muted col-sm-9">
      <h1>More About <a class="mainTextDark bold" :href="'./'+schemaClass" v-text="schemaClass"></a></h1>
      <div class="jumbotron mb-0" v-if="getRangePropertyInfoResults.length">
        <h3>
          Properties with <a class="mainTextDark bold" :href="'./'+schemaClass" v-text="schemaClass"></a> as Expected Type
        </h3>
        <table class="table  table-light table-striped" style="margin-bottom: 40px">
          <thead class="mainBackDark">
            <tr>
              <th>

              </th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(item,i) in getRangePropertyInfoResults">
              <td >
                <a class="font-weight-bold" :href='"./"+getTitle(item)'>
                  <h5 v-html=getTitle(item)></h5>
                </a>
                <small v-html=getDescription(item) class=""></small>
                <hr />
                <small class="badge badge-light text-muted">Expected Type: </small>
                <template v-for="(type,i) in getType(item)">
                  <a :href="generateLink(type)" class="mainTextDark bold">
                    <small>
                      <i class="fas fa-circle mainTextDark"></i> <span v-html='type'></span>
                    </small>
                    <i v-if="generateLink(type)[0] !== '.'" class="fas small fa-external-link-alt"></i>
                  </a>
                  <span v-if="i !== getType(item).length-1">, </span>
                </template>
              </td>
          </tbody>
        </table>
      </div>
      <div class="jumbotron" v-if="moreSpecifTypes && moreSpecifTypes.length">
        <h3>
          More Specific Types:
        </h3>
        <p>
          Types with <a class="mainTextDark" :href="'./'+schemaClass" v-text="schemaClass"></a> as a Subclass
        </p>
        <ul >
          <li v-for="item in moreSpecifTypes">
            <a :href="'./'+item" v-text="item"></a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div class="modal fade" id="registration" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title text-muted caps" id="exampleModalLabel">Registration</h4>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div v-if="urlRegistered" class="modal-body p-5 alert alert-warning">
          <p class="w-75 m-auto">
            <i class="fas fa-exclamation-circle text-warning"></i> This URL has already been registered.
          </p>
          <p class="w-75 m-auto">
            Please use your <a href="/dashboard">dashboard</a> to make changes.
          </p>
        </div>
        <div v-else class="modal-body text-muted text-center">
          <template v-if="userInfo.login">
            <form id="registrationForm">
              <div class="form-group row">
                <div class="col-sm-12">
                  <p v-if="!namespaceInput">
                    Recommended slug found in graph context: Use <a class="badge badge-pill mainBackLight text-light pointer" @click.prevent='namespaceInput = namespace'><b v-text="namespace"></b></a>
                  </p>
                </div>
                <div class="col-sm-12">
                  <h4>Choose a namespace</h4>
                </div>
                <label class="col-sm-4 col-form-label" for="exampleFormControlInput1">Namespace</label>
                <div class="col-sm-8">
                  <textarea required="" data-parsley-trigger="keyup" data-parsley-minlength="2" data-parsley-maxlength="30" data-parsley-minlength-message="Must me at least 2 letters" data-parsley-validation-threshold="10" type="text" rows="1" class="form-control" id="namespaceInput" v-model='namespaceInput'></textarea>
                  <template v-if="availableSlug && namespaceInput.length">
                    <small class="text-success bold"><i class="fas fa-check"></i> AVAILABLE</small>
                  </template>
                  <template v-if="!availableSlug && namespaceInput.length">
                    <small class="text-danger bold"><i class="fas fa-times"></i> NOT AVAILABLE</small>
                  </template>
                  <template v-if="invalidChars">
                    <br />
                    <small class="text-warning bold"><i class="fas fa-times"></i> INVALID CHARACTERS</small>
                  </template>
                  <p class="m-2" :class="[availableSlug ? 'mainTextDark' : 'text-danger']">
                    discovery.biothings.io/<span class="bold" v-text='namespaceInput'></span>
                  </p>
                </div>
              </div>
              <div class="form-group row">
                <label for="colFormLabelSm" class="col-sm-4 col-form-label col-form-label">Source URL</label>
                <div class="col-sm-8">
                  <input required="" disabled type="url" class="form-control form-control disabled" id="colFormLabelSm" placeholder="enter url here" v-model="dataSetURL">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-sm-4 col-form-label" for="exampleFormControlSelect1">Classes (<span class="text-success" v-text="allAvailableClasses.length"></span>)</label>
                <div class="col-sm-8">
                  <select class="form-control" id="exampleFormControlSelect1">
                    <template v-for="item in allAvailableClasses">
                      <option v-text="item"></option>
                    </template>
                  </select>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-sm-4 col-form-label" for="exampleFormControlSelect2">Properties (<span class="text-success" v-text="allAvailableProperties.length"></span>)</label>
                <div class="col-sm-8">
                  <select class="form-control" id="exampleFormControlSelect2">
                    <template v-for="item in allAvailableProperties">
                      <option v-text="item"></option>
                    </template>
                  </select>
                </div>
              </div>
              <div class="mb-4">
                <button v-if="!registered" @click.prevent="handleSubmit()" class="btn themeButton pulse text-light" :disabled="!availableSlug && namespaceInput">Submit</button>
                <button v-if="registered" type="button" class="btn btn-danger" data-dismiss="modal" aria-label="Close">
                  Close
                </button>
              </div>
              <div v-if="registered" class="bg-success text-light p-5">
                <p>
                  Your schema has been added to the registry.
                </p>
              </div>
            </form>
          </template>
          <template v-else>
            <div class="alert alert-warning">
              <h4>You must be logged in to register this dataset</h4>
            </div>
          </template>
        </div>
      </div>
    </div>
  </div>

  <!-- Button trigger modal -->


  <!-- Modal -->
  <div class="modal fade" id="changeClass" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title text-muted" id="exampleModalLabel">Classes available in this schema</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <template v-if="availableClasses.length>20">
            <ul class="list-group">
              <li class="list-group-item mainBackDark text-light text-center">
                Filter by
              </li>
              <li class="list-group-item">
                <select @change='handleChange' class="custom-select mr-sm-2" id="inlineFormCustomSelect">
                  <option selected>Filter by...</option>
                  <option v-for="letter in filterLetters" :value="letter" v-text="letter"></option>
                </select>
              </li>
              <li class="list-group-item text-light mainBackDark twoEM text-center" v-if='filter' v-text='filter'>

              </li>
              <li class="list-group-item" v-if='filter'>
                <select @change='handleFilter' class="custom-select mr-sm-2" id="inlineFormCustomSelect">
                  <option selected v-text='"Choose..."'></option>
                  <option v-for="(item,i) in filterResults" :value="item['rdfs:label']" v-text="item['rdfs:label']"></option>
                </select>
              </li>
            </ul>
          </template>
          <!-- If class list is less than 20 -->
          <template v-else>
            <ul class="list-group">
              <li class="list-group-item mainBackLight text-light text-center">
                Schemas
              </li>
              <li class="list-group-item">
                <select @change='handleFilter' class="custom-select mr-sm-2" id="inlineFormCustomSelect">
                  <option selected v-text='"Choose..."'></option>
                  <option v-for="(item,i) in availableClasses" :value="item['rdfs:label']" v-text="item['rdfs:label']"></option>
                </select>
              </li>
            </ul>
          </template>
        </div>
      </div>
    </div>
  </div>

</div>

{% endblock %}
{% block extra_scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
<!-- <script src="https://unpkg.com/tippy.js@3/dist/tippy.all.min.js"></script> -->
<script src="/static/js/lodash.js"></script>
<script src="https://d3js.org/d3.v3.js"></script>
<script src="/static/js/networkx.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jsonld@1.0.0/dist/jsonld.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@7.28.11/dist/sweetalert2.all.min.js"></script>
<script>
var app = new Vue({
      el: '#viewer',
			data: function(){
				return {
          filter:'',
          graph: [],
          context: {},
          query:'',
          schemaClass:'',
          properties:[],
          parentProperties: [],
          property:'',
          propertyInfo:{},
          classes:[],
          subclass: '',
          classInfo:{},
          availableClasses:[],
          filterResults:[],
          lineageArray:[],
          displayResults:[],
          parentDisplayResults:[],
          additionalPaths:[],
          userURL:'',
          nxG: null,
          allPaths:[],
          edgeGraph: [],
          parentClassesAndProps:[],
          usedOnTheseTypes: [],
          rangeIncludes: [],
          showGraph: false,
          namespace : '',
          filterLetters:[],
          availableClassesNames:[],
          rangeFromClassResults:[],
          getRangePropertyInfoResults:[],
          searchQuery:'',
          searchResults:[],
          viewAlphabetical: true,
          rootNode:'',
          moreSpecifTypes:[],
          slugRegistered: false,
          userInfo:{},
          allAvailableProperties:[],
          allAvailableClasses:[],
          namespaceInput:'',
          availableSlug: false,
          dataSetURL:'',
          invalidChars: false,
          registered: false,
          urlRegistered: false,
          searchResultsProps:[],
          fullPropList:[],
          //  NEW VIEWER DATA
          userSchema: [],
          userSchemaURL: '',
          userSchemaAllProps:[],
          parentList:[],
          userSchemaParents:[]
				}
			},
      computed:{

      },
      watch:{
        searchQuery:function(newQ,oldQ) {
          if (newQ.length) {
            let result = _.filter(this.userSchema, function(o) {
                if (o['name'].toLowerCase().includes(newQ.toLowerCase())) {
                  return o;
                }
            });
            let resultProps = _.filter(this.userSchemaAllProps, function(o) {
                if (o['name'].toLowerCase().includes(newQ.toLowerCase())) {
                  return o;
                }
            });

            this.searchResults = result;
            this.searchResultsProps = resultProps;

          }else{
            this.searchResults = [];
            this.searchResultsProps = [];
          }
        },
        namespaceInput:function(newInput, oldInput){
          var self = this;
          self.namespaceInput = self.namespaceInput.toLowerCase();


          var re = /^[a-zA-Z0-9_.-]*$/;
          if (!re.test(newInput) ) {
            self.invalidChars = true;
          }else{
            self.invalidChars = false;
          }

          if (newInput && !self.invalidChars) {
            axios.get(`/api/registry/`+self.namespaceInput).then(function (response) {
              // console.log('namespace check',newInput,response)
              if (response.data.url) {
                self.availableSlug= false;
              }
            }).catch(err=>{
              self.availableSlug= true;
              throw err;
            });
          }
        },
        dataSetURL:function(newurl,oldurl){
          var self = this;
          if (newurl) {
            axios.get(`/api/query?q=_meta.url:`+'"'+newurl+'"').then(function (response) {
              if (response.data.total) {
                self.urlRegistered = true;
              }else{
                self.urlRegistered = false;
              }
            });
          }
        }
      },
			methods:{
        RemoveLastDirectoryPartOf(the_url){
          var the_arr = the_url.split('/');
          the_arr.pop();
          return( the_arr.join('/')+'/' );
        },
        handleSubmit(){
          let self = this;
          let valid = $('#registrationForm').parsley().validate();

          if (valid) {
            let body = {
              'url' : self.dataSetURL,
              'name' : self.namespaceInput
            }
            // console.log('REQ BODY',body);
            axios.post('/api/registry',body).then(res=>{
              console.log('POST response ',res.data)
              if (res.data.url) {

                Swal.fire({
                  type: 'success',
                  toast: true,
                  position: 'bottom',
                  title: 'Registration Successful',
                  html: "Data can now be accessed on <a href='/"+self.namespaceInput+"/'>"+window.location.origin+"/"+self.namespaceInput+"/"+"</a>"
                });
                self.registered = true;

              }else if (res.data.url){
                Swal.fire({
                  type: 'error',
                  toast: true,
                  position: 'top',
                  title: 'Registration Failed',
                  text: res.data.error
                });
              }

            }).catch(err=>{

              Swal.fire({
                type: 'error',
                toast: true,
                position: 'top center',
                title: 'Registration Failed',
                text: err,
                showConfirmButton: false,
                timer: 2000
              });

              throw err;
            });
          }
        },
        getAllAvailableProperties(){
          let results = [];
          for (var i = 0; i < this.graph.length; i++) {
            if (this.graph[i].hasOwnProperty('@type') && this.graph[i]['@type'] === "rdf:Property") {
              results.push(this.graph[i]['rdfs:label']);
            }
          }
          this.allAvailableProperties = results.sort();
        },
        getMoreSpecifTypes(){
          var self = this;
          let res = [];
          for (var i = 0; i < self.graph.length; i++) {
            if (self.graph[i].hasOwnProperty("rdfs:subClassOf") && _.isPlainObject(self.graph[i]["rdfs:subClassOf"])) {
              let current = self.removePrefix(self.graph[i]["rdfs:subClassOf"]['@id']);
              if (current === self.query) {
                res.push(self.graph[i]["rdfs:label"]);
              }
            }
            else if (self.graph[i].hasOwnProperty("rdfs:subClassOf") && _.isArray(self.graph[i]["rdfs:subClassOf"])) {
              for (var x = 0; x < self.graph[i]["rdfs:subClassOf"].length; x++) {
                let currentIndex = self.removePrefix(self.graph[i]["rdfs:subClassOf"][x]['@id']);
                if ( currentIndex === self.query) {
                  res.push(self.graph[i]["rdfs:subClassOf"][x]);
                }
              }
            }
          }
          self.moreSpecifTypes = res;
        },
        makeHierarchyTree(){
          var self = this;
          if (!self.query) {
            self.nxG = new jsnx.DiGraph();
            if (self.userSchema.length > 1) {
              for (var i = 0; i < self.userSchema.length; i++) {
                if(self.userSchema[i].hasOwnProperty("clses") ){
                  self.addNode(self.userSchema[i]["name"]);
                  let parents = self.userSchema[i]["clses"][0];
                  if (parents) {
                    parents = parents.split(", ");
                    //only add an edge to immediate parent class
                    self.addNode(parents[parents.length-1]);
                    self.addEdge(parents[parents.length-1],self.userSchema[i]["name"]);
                  }
                }
              }
            }
            let topoRes = jsnx.topologicalSort(this.nxG);
            let rootNode = topoRes[0];
            this.rootNode= rootNode;
          }
        },
        getNeighbors(node){
          if (node) {
            let neighbors = this.nxG.neighbors(node);
            return neighbors;
          }
        },
        switchView(){
          this.viewAlphabetical = !this.viewAlphabetical;
        },
        getRangeFromClass(){
          let self = this;
          let query =self.query;

          for (var i = 0; i < self.graph.length; i++) {
            if (self.graph[i].hasOwnProperty("schema:rangeIncludes") && _.isPlainObject(self.graph[i]["schema:rangeIncludes"])) {
              let current = self.removePrefix(self.graph[i]["schema:rangeIncludes"]["@id"]);
              if (current === query) {
                self.rangeFromClassResults.push(self.graph[i]["rdfs:label"])
              }
            }
            if (self.graph[i].hasOwnProperty("schema:rangeIncludes") && _.isArray(self.graph[i]["schema:rangeIncludes"])) {
              for (var x = 0; x < self.graph['schema:rangeIncludes'].length; x++) {
                let current = self.removePrefix(self.graph[i]['schema:rangeIncludes'][x]["@id"]);
                if (current === query) {
                  self.rangeFromClassResults.push(self.graph[i]["rdfs:label"])
                }
              }
            }
          }
          this.getRangePropertyInfo();
        },
        getRangePropertyInfo(){
          var self = this;

          for (var x = 0; x < self.rangeFromClassResults.length; x++) {
            for (var i = 0; i < self.graph.length; i++) {
              if (self.graph[i].hasOwnProperty('schema:domainIncludes') && self.graph[i]["@type"] === "rdf:Property" && self.graph[i]['rdfs:label'] === self.rangeFromClassResults[x] ) {
                self.getRangePropertyInfoResults.push(self.graph[i]);
              }
            }
          }
        },
        generateLink(query){
          var self = this;
          var link = ''
          for (var i = 0; i < self.userSchema.length; i++) {
            // console.log(query,self.userSchema[i]["name"])

            if(_.isString(self.userSchema[i]["name"])){
              if (self.userSchema[i]["name"] === query)
                {
                  return link = './'+query;
                }
                else{
                  // To Do: Get context and link out
                  var linkExpanded = self.context[self.namespace]+query;
                  link = linkExpanded;
                }
            }

          }
          return link;
        },
        checkLinks(myList){

          var self = this;

          for (var x = 0; x < myList.length; x++) {

            let query = self.removePrefix(myList[x]['@id']);
            for (var i = 0; i < self.graph.length; i++) {

              //IF OBJECT
              if (_.isPlainObject(self.graph[i]["rdfs:label"])) {
                if (self.graph[i]["rdfs:label"]['@value'] === query)
                  {
                    myList[x] = Object.assign({'link':'./'+query, 'linkOut': false}, myList[x]);
                  }
              }
              //IF NOT OBJECT
              else{
                if (self.graph[i]["rdfs:label"] === query)
                  {
                    myList[x] = Object.assign({'link':'./'+query, 'linkOut': false}, myList[x]);
                  }
                  // ELSE EXPAND AND LINK OUT
                  else{
                    if (self.context[self.namespace]) {

                      let arr = myList[x]['@id'].split(':');
                      let text = arr[arr.length-1];
                      let prefix = arr[0];
                      var linkExpanded = self.context[prefix]+text;
                      myList[x] = Object.assign({'link':linkExpanded, 'linkOut': true}, myList[x]);

                    }else{
                      myList[x] = Object.assign({'link':'', 'linkOut': false}, myList[x]);
                    }
                  }
              }

            }
          }
          return myList;
        },
        toggleGraph(){
          this.showGraph = !this.showGraph;
          if (this.showGraph) {
            this.makeQueryGraph();
          }
        },
        removePrefix(text){
          if (text.includes('http')) {
            return text.split("/").pop()
          }else{
            let arr = text.split(':');
            text = arr[arr.length-1];
            return text;
          }
        },
        allIndices(arr, val){
            var indices = [],
                i;
            for (i = 0; i < arr.length; i++) {
                if (arr[i] === val) {
                    indices.push(i);
                }
            }
            return indices;
        },
        hasEdgeBeenFollowedInPath({ edge, path }) {
            var indices = this.allIndices(path, edge.from);
            return indices.some(i => path[i + 1] === edge.to);
        },
        nodes(graph, node){
          return graph.reduce((p, c) => {
              (c[0] === node) && p.push(c[1]);
              return p;
          }, []);
        },
        memoize(fn){
          const cache = new Map();
          return function() {
              var key = JSON.stringify(arguments);
              var cached = cache.get(key);
              if (cached) {
                  return cached;
              }
              cached = fn.apply(this, arguments)
              cache.set(key, cached);
              return cached;;
          };
        },
        paths(graph =[],from, to, path =[]){
          var self= this;
          const linkedNodes = self.memoize(self.nodes.bind(null, graph));
          return explore(from, to);

          function explore(currNode, to, paths = []) {
              path.push(currNode);
              for (let linkedNode of linkedNodes(currNode)) {
                  if (linkedNode === to) {
                      let result = path.slice(); // copy values
                      result.push(to);
                      paths.push(result);
                      continue;
                  }
                  // do not re-explore edges
                  if (!self.hasEdgeBeenFollowedInPath({
                          edge: {
                              from: currNode,
                              to: linkedNode
                          },
                          path
                      })) {
                      explore(linkedNode, to, paths);
                  }
              }
              path.pop(); // sub-graph fully explored
              return paths;
          }
        },
        getAllPaths(){
          if (this.lineageArray.length) {
            let from = this.lineageArray[0]["@id"];
            let to = this.classInfo["@id"];
            let path = jsnx.shortestPath(this.nxG, {source: from,target: to});

            let g = JSON.parse(JSON.stringify(this.edgeGraph));

            let res = this.paths(g,path[0],path[path.length-1])
            this.allPaths = res;
            // this.getUniqueContent(res);
            this.getParentData();
          }
        },
        getUniqueContent(paths){
          var finalArr = [];
          let mergedpaths =[]
          for (var i = 0; i < paths.length; i++) {
            mergedpaths = mergedpaths.concat(paths[i])
          }

          function onlyUnique(value, index, self) {
            return self.indexOf(value) === index;
          }
          finalArr =  mergedpaths.filter( onlyUnique );
          return finalArr;
        },
        returnFullClassInfo(name){
          this.getAvailableClasses();
            for (var i = 0; i < this.availableClasses.length; i++) {
              if (this.availableClasses[i].hasOwnProperty('@type') && this.availableClasses[i]['@type'] === "rdfs:Class" && this.availableClasses[i]["rdfs:label"].toLowerCase() === name.toString().toLowerCase()) {
                return this.availableClasses[i]["rdfs:label"]
              }
            }
          },
        makeGraph(){
          this.nxG = new jsnx.Graph();
          this.getAvailableClasses();
          let grabFrom = this.availableClasses;

          if (grabFrom.length > 1) {
            for (var i = 0; i < grabFrom.length; i++) {
              if (grabFrom[i].hasOwnProperty("rdfs:subClassOf") && _.isPlainObject(grabFrom[i]["rdfs:subClassOf"]) ) {
                this.addNode(grabFrom[i]["@id"]);
                this.addNode(grabFrom[i]["rdfs:subClassOf"]["@id"]);
                this.addEdge(grabFrom[i]["@id"],grabFrom[i]["rdfs:subClassOf"]["@id"])
              }
              else if(grabFrom[i].hasOwnProperty("rdfs:subClassOf") && _.isArray(grabFrom[i]["rdfs:subClassOf"]) ){
                this.addNode(grabFrom[i]["@id"]);
                for (var x = 0; x < grabFrom[i]["rdfs:subClassOf"].length; x++) {
                  this.addNode(grabFrom[i]["rdfs:subClassOf"][x]["@id"]);
                  this.addEdge(grabFrom[i]["@id"],grabFrom[i]["rdfs:subClassOf"][x]["@id"])
                }
              }
            }
          }
          this.getClassLineage(this.classInfo);
          this.getAllPaths();
          this.getRangeFromClass();
          this.getMoreSpecifTypes();
        },
        makeQueryGraph(){
          let self = this;
          let smallG = new jsnx.Graph();
          let arr = [];

          for (var i = 0; i < self.classInfo["clses"].length; i++) {
            arr = arr.concat(self.classInfo["clses"][i].split(', '))
          }
          arr = arr.concat([self.schemaClass]);

          console.log('arr',arr)

          if (arr.length) {
            for (var i = 0; i < arr.length; i++) {
              if (arr[i-1]) {
                smallG.addNode(arr[i]);
                smallG.addEdge(arr[i],arr[i-1]);
              }
            }
          }else{
            smallG.addNode(this.classInfo["name"],{'label':this.classInfo["name"]});
          }
          this.drawGraph(smallG, '#canvas');
        },
        drawGraph(g,container){
          jsnx.draw(g, {
            element: container,
            weighted: true,
            edgeStyle: {
                'stroke-width': 10,
                'fill': '#b4b4b4'
            },
            layoutAttr: {
                charge: -800,
                linkDistance: 100
            },
            height:300,
            labelStyle: {fill: '#5C3069'},
            withLabels: true,
            nodeLabels: 'label',
            nodeStyle: {
                'stroke': '#8feddc',
                'fill': '#84dcdf',
                'cursor': 'pointer',
                'nodeShape':'s'
            }
          });
        },
        addNode(className){
          this.nxG.addNode(className,{'label':className});
        },
        addEdge(class1,class2){
          this.nxG.addEdge(class1,class2);
          let node = [class2,class1];
          this.edgeGraph.push(node);
        },
        getClassLineage(classInfo){
          let subclass ='';
          this.getAvailableClasses();
          if (classInfo.hasOwnProperty("rdfs:subClassOf") && _.isPlainObject(classInfo["rdfs:subClassOf"])) {
            subclass = classInfo["rdfs:subClassOf"]['@id'];
            for (var i = 0; i < this.availableClasses.length; i++) {
              if (this.availableClasses[i]['@id'] === subclass) {
                this.lineageArray.unshift(this.availableClasses[i])
                this.getClassLineage(this.availableClasses[i])
              }
            }
          }
          if (classInfo.hasOwnProperty("rdfs:subClassOf") && _.isArray(classInfo["rdfs:subClassOf"])) {
            //if array take the first index and explore further
            subclass = classInfo["rdfs:subClassOf"][0]['@id'];
            for (var i = 0; i < this.availableClasses.length; i++) {
              if (this.availableClasses[i]['@id'] === subclass) {
                this.lineageArray.unshift(this.availableClasses[i])
                this.getClassLineage(this.availableClasses[i])
              }
            }
          }

        },
        returnSubclass(className){
          let classInfo = this.returnClass(className);
          let subclass = '';
          if (classInfo.hasOwnProperty("rdfs:subClassOf") && !_.isArray(classInfo["rdfs:subClassOf"])) {
              subclass = this.removePrefix(classInfo["rdfs:subClassOf"]['@id']);
              return subclass;
          }else{
            return false;
          }
        },
        getParentData(){
          for (var i = 0; i < this.parentDisplayResults.length-1; i++) {
            let parent = this.parentDisplayResults[i];
            let props = this.returnProps(this.parentDisplayResults[i]);
            this.shapeData(parent,props);
          }
        },
        shapeData(parent,props){
          let obj = {
            'className' : this.removePrefix(parent),
            'props' : props
          }
          this.parentClassesAndProps.unshift(obj);
        },
        returnClass(classInfo){
          if (_.isObject(classInfo)) {
            for (var i = 0; i < this.graph.length; i++) {
              if (this.graph[i].hasOwnProperty('@type') && this.graph[i]['@type'] === "rdfs:Class" && this.graph[i]["rdfs:label"].toLowerCase() === classInfo["rdfs:label"].toLowerCase()) {
                return this.graph[i];
              }
            }
          }

          if (_.isString(classInfo)) {
            for (var i = 0; i < this.graph.length; i++) {
              if (this.graph[i].hasOwnProperty('@type') && this.graph[i]['@type'] === "rdfs:Class" && this.graph[i]["rdfs:label"].toLowerCase() === classInfo.toLowerCase() || this.graph[i]["@id"] === classInfo ) {
                return this.graph[i];
              }
            }
          }

        },
        returnProps(classInfo){
          let properties = [];

            for (var i = 0; i < this.graph.length; i++) {

              if (this.graph[i].hasOwnProperty('schema:domainIncludes') && this.graph[i]["@type"] === "rdf:Property") {
                if ( _.isString(this.graph[i]['schema:domainIncludes']) ) {
                  if (this.graph[i]["schema:domainIncludes"] === classInfo || this.graph[i]["schema:domainIncludes"] === classInfo["rdfs:label"]) {
                    properties.push(this.graph[i]);
                  }
                }
                else if ( _.isArray(this.graph[i]['schema:domainIncludes']) ) {
                  for (var x = 0; x < this.graph[i]['schema:domainIncludes'].length; x++) {
                    if (this.graph[i]["schema:domainIncludes"][x]['@id'] === classInfo || this.graph[i]["schema:domainIncludes"][x]['@id'] === classInfo["rdfs:label"]) {
                      properties.push(this.graph[i]);
                    }
                  }
                }else if( _.isObject(this.graph[i]['schema:domainIncludes']) ){
                  if (this.graph[i]["schema:domainIncludes"]['@id'] === classInfo || this.graph[i]["schema:domainIncludes"]['@id'] === classInfo["rdfs:label"]) {
                    properties.push(this.graph[i]);
                  }
                }
                properties = _.sortBy(properties, [user => user['rdfs:label']], ['asc']);
              }

            }
            return properties;
        },
        handleFilter(e){
          if (e.target.value !== 'Choose...') {
            window.location.href = "./"+e.target.value;
          }
        },
        findDisplaySchema(){
          for (var i = 0; i < this.graph.length; i++) {
            if (this.graph[i].hasOwnProperty('@type') && this.graph[i]['@type'] === "rdfs:Class"){
              this.query = this.graph[i]["rdfs:label"];
            }
          }
        },
        determinePath(){
          console.log('determining path...')
          if (this.getClass()) {
            console.log('PATH: CLASS')
            this.property='';
            this.getClassProperties();
            this.makeGraph();
          }else{
            console.log('PATH: PROPERTY')
            this.getPropertyInfo()
          }
        },
        getTitle: function(data){
          if (data.hasOwnProperty('rdfs:label')) {
            if (_.isObject(data['rdfs:label'])) {
              if (data['rdfs:label'].hasOwnProperty('@value')) {
                return data['rdfs:label']['@value']
              }else{
                return data['rdfs:label'];
              }
            }else if (_.isString(data['rdfs:label'])) {
              return data["rdfs:label"];
            }
          }else{
            return 'no property name available'
          }
        },
        getType: function(data){
          let types=[];
          if (data.hasOwnProperty("schema:rangeIncludes")) {
            if (_.isString(data["schema:rangeIncludes"])) {
              let type = data['schema:rangeIncludes'].split(':');
              type = type[type.length-1];
              types.push(type);
            }
            else if (_.isArray(data["schema:rangeIncludes"])) {
              for (var i = 0; i < data['schema:rangeIncludes'].length; i++) {
                let type = data['schema:rangeIncludes'][i]['@id'].split(':');
                type = type[type.length-1];
                types.push(type);
              }
            }else if(_.isObject(data["schema:rangeIncludes"])){
              let type = data['schema:rangeIncludes']['@id'].split(':');
              type = type[type.length-1];
              types.push(type);
            }
          }
          return types;
        },
        getDescription: function(data){
          if (data.hasOwnProperty("rdfs:comment")) {
            return data["rdfs:comment"];
          }else{
            return 'no description available'
          }
        },
        getClassProperties(){
          this.properties = [];
            for (var i = 0; i < this.graph.length; i++) {
              if (this.graph[i].hasOwnProperty('schema:domainIncludes') && this.graph[i]["@type"] === "rdf:Property") {
                this.extractPropertyInfo(this.graph[i]);
              }
            }
            this.getParentProperties();
        },
        getParentProperties(){
          this.parentProperties = [];
          if (this.subclass) {
            for (var i = 0; i < this.graph.length; i++) {
              if (this.graph[i].hasOwnProperty('schema:domainIncludes') && this.graph[i]["@type"] === "rdf:Property") {
                this.extractParentPropertyInfo(this.graph[i])
              }
            }
          }
        },
        extractPropertyInfo(data){
          if ( _.isString(data['schema:domainIncludes']) ) {
              let idValue = data["schema:domainIncludes"].split(':');
              idValue = idValue[idValue.length-1];
              if (idValue.toLowerCase() === this.query.toLowerCase()) {
                this.properties.push(data);
              }
          }
          else if ( _.isArray(data['schema:domainIncludes']) ) {
            for (var i = 0; i < data['schema:domainIncludes'].length; i++) {
              let idValue = data["schema:domainIncludes"][i]['@id'].split(':');
              idValue = idValue[idValue.length-1];
              if (idValue.toLowerCase() === this.query.toLowerCase()) {
                this.properties.push(data);
              }
            }
          }else if( _.isPlainObject(data['schema:domainIncludes']) ){
            let idValue = data["schema:domainIncludes"]['@id'].split(':');
            idValue = idValue[idValue.length-1];
            if (idValue.toLowerCase() === this.query.toLowerCase() ) {
              this.properties.push(data);
            }
          }
          this.properties = _.sortBy(this.properties, [user => user['rdfs:label']], ['asc']);
        },
        extractParentPropertyInfo(data){
          if ( _.isArray(data['schema:domainIncludes']) ) {
            for (var i = 0; i < data['schema:domainIncludes'].length; i++) {
              if (data["schema:domainIncludes"][i]['@id'].toLowerCase() === this.namespace+':'+this.subclass.toLowerCase() || data["schema:domainIncludes"][i]['@id'].toLowerCase() === this.subclass.toLowerCase()) {
                this.parentProperties.push(data);
              }
            }
          }else if( _.isObject(data['schema:domainIncludes']) ){
            if (data["schema:domainIncludes"]['@id'].toLowerCase() === this.namespace+':'+this.subclass.toLowerCase() || data["schema:domainIncludes"]['@id'].toLowerCase() === this.subclass.toLowerCase() ) {
              this.parentProperties.push(data);
            }
          }
          this.parentProperties = _.sortBy(this.parentProperties, [user => user['rdfs:label']], ['asc']);
        },
        getClass(){
          let results = [];
          let self = this;
          console.log('Looking for class: ',self.query, self.userSchema)
          for (var i = 0; i < self.userSchema.length; i++) {
            if (self.userSchema[i]["name"] === self.query ) {
              self.schemaClass = self.userSchema[i]["name"];
              self.classInfo = self.userSchema[i];
              console.log('FOUND CLASS', self.classInfo['name'])
            }
          }
          if (self.schemaClass) {
            return true;
          }else{
            return false;
          }
        },
        getAvailableClasses(){
          let results = [];
          let props=[];
          let resultsForRegistration = [];
          for (var i = 0; i < this.graph.length; i++) {
            if (this.graph[i].hasOwnProperty('@type') && this.graph[i]['@type'] === "rdfs:Class") {
              results.push(this.graph[i]);
              resultsForRegistration.push(this.graph[i]['rdfs:label']);
            }
            else if (this.graph[i].hasOwnProperty('@type') && this.graph[i]['@type'] === "rdf:Property") {
              props.push(this.graph[i]);
            }
          }
          this.fullPropList = props.sort();
          // console.log(this.fullPropList)
          this.availableClasses = results.sort();
          this.allAvailableClasses = resultsForRegistration.sort();
          this.orderAlphabetically();
          this.getAllAvailableProperties();
          this.getFilters();
        },
        orderAlphabetically(){
          var self = this;
          let res =[];
          for (var i = 0; i < self.userSchema.length; i++) {
            res.push(self.userSchema[i]['name']);
          }

          let data = res.reduce((r, e) => {
            let group = e.split(":")[1][0];
            if(!r[group]) r[group] = {group, children: [e]}
            else r[group].children.push(e);
            return r;
          }, {});

          res = Object.values(data)
          self.availableClassesNames= _.orderBy(res, ['group'], ['asc']);
          self.makeHierarchyTree();
          self.getAllProps();
          self.getFilters();
        },
        getFilters(){
          let letters = [];
          let self = this;
          for (var i = 0; i < self.userSchema.length; i++) {
            let q = self.userSchema[i]["name"].split(':')[1][0];
            if ( !letters.includes(q) ) {
              letters.push( q );
            }
          }
          this.filterLetters = letters.sort();
        },
        handleChange: function(e){
          let target = e.target.value;
          this.filter = e.target.value;
          let fullList = this.userSchema;
          let results = [];
          switch (target) {
            case 'ALL':
              this.filterResults = fullList;
              break;
            default:
              results = fullList;
              results = fullList.filter(word => word["name"].split(":")[1][0] === target);
              this.filterResults =  _.sortBy(results, [user => user['name'].split(":")[1]], ['asc']);
          }
        },
        getSubclass(data){
          if (data.hasOwnProperty("rdfs:subClassOf") && _.isPlainObject(data["rdfs:subClassOf"])) {
            let sc = data["rdfs:subClassOf"]['@id'].split(':');
            sc = sc[sc.length-1];
            this.subclass = sc;
            return data["rdfs:subClassOf"]['@id'];
          }
        },
        getPropertyInfo(){
          let res =[];
          for (var i = 0; i < this.graph.length; i++) {
            if (this.graph[i].hasOwnProperty("rdfs:label") && this.graph[i]["rdfs:label"] === this.query) {
              this.property = this.graph[i]["rdfs:label"];
              res.push(this.graph[i]);
              this.propertyInfo = this.graph[i];
            }
          }
          this.properties = res;
          this.parsePropertyInfo();
        },
        parsePropertyInfo(){
          let res =[];
          let range = [];
          if (this.propertyInfo.hasOwnProperty("schema:domainIncludes") && _.isPlainObject(this.propertyInfo["schema:domainIncludes"])) {
            res.push(this.propertyInfo["schema:domainIncludes"]["@id"]);
          }
          else if(this.propertyInfo.hasOwnProperty("schema:domainIncludes") && _.isArray(this.propertyInfo["schema:domainIncludes"])){
            for (var i = 0; i < this.propertyInfo["schema:domainIncludes"].length; i++) {
              res.push(this.propertyInfo["schema:domainIncludes"][i]["@id"]);
            }
          }
          if (this.propertyInfo.hasOwnProperty("schema:rangeIncludes") && _.isPlainObject(this.propertyInfo["schema:rangeIncludes"])) {
            range.push(this.propertyInfo["schema:rangeIncludes"]["@id"]);
          }
          else if(this.propertyInfo.hasOwnProperty("schema:rangeIncludes") && _.isArray(this.propertyInfo["schema:rangeIncludes"])){
            for (var i = 0; i < this.propertyInfo["schema:rangeIncludes"].length; i++) {
              range.push(this.propertyInfo["schema:domainIncludes"][i]["@id"]);
            }
          }
          this.usedOnTheseTypes = res;
          this.rangeIncludes = range;
        },
        checkIfRegistered(){
          let self = this;
          // let namespace = window.location.pathname.split('/');
          // namespace = namespace.slice(1,window.location.pathname.length-1)[0];
          console.log('checking..',self.namespace)
          axios.get(`/api/registry/`+self.namespace).then(function (res) {
            console.log('reg check ', res)
            if (res.data) {
              let url = res.data.url;
              if (url) {
                self.registered = true;
                self.reqFile(url);
                console.log('registered')
              }else{
                Swal.fire(
                  'This namespace is registered but..',
                  'No URL was found',
                  'error'
                );
              }
            }
          }).catch(err=>{
            console.log('not registered')
            self.reqFile();
            throw err;
          });
        },
        reqFile: function(url){
          let self = this;
          if (url && self.registered) {
            console.log('LOADING FROM URL')
            axios.get('/api/schema?url='+url).then(res=>{
              // console.log('load success')
              // console.log(res.data)
              // this.graph = res.data['@graph'];
              // this.context = res.data['@context'];
              // this.determinePath()
              // this.getAvailableClasses()
            }).catch(err=>{
              throw err;
              Swal.fire(
                'Oops!',
                'Something went wrong loading this url',
                'error'
              );
            });
          }else if(!url){
            console.log('LOADING FROM LOCALSTORAGE')
            this.userSchema = JSON.parse(localStorage.getItem('user-schema-classes'));
            this.userSchemaURL = localStorage.getItem('user-schema-url');
            console.log('userSchema',this.userSchema)
            // this.graph = retrievedObject['@graph'];
            // this.context = retrievedObject['@context'];
            this.determinePath()
            this.orderAlphabetically()
          }

        },
        checkUser(){
          let self = this;
          $.ajax({url: "/user", success: function(result){
             self.userInfo = result;
          },
          cache: false});
        },
        getAllProps(){
          let res = [];
          let self = this;
          for (var i = 0; i < self.userSchema.length; i++) {
            if (self.userSchema[i].hasOwnProperty('props') && self.userSchema[i]['props'].length>0) {
              res = res.concat(self.userSchema[i]['props']);
            }
          }
          self.userSchemaAllProps = res;
          // console.log('ALL Props', self.userSchemaAllProps)
        },
        getPaths(classInfo){
          console.log('getting all possible paths...')
          var self = this;
          let res = [];
          for (var i = 0; i < classInfo["clses"].length; i++) {
            if (classInfo["clses"][i]) {
              let parents =classInfo["clses"][i].split(', ');
              // parents.push(classInfo.name)
              res.push(parents)
            }
          }
          console.log('ALL PATHS',res)
          self.parentList = self.getUniqueContent(res).reverse();
          console.log('Unique Parents',self.parentList)
          // self.getParentsInfo(self.parentList)
          return res;
        },
        getPropertiesFor(classInfo){
          var self = this;
          console.log('getting props for ', classInfo.name);
          if (classInfo.hasOwnProperty('props') && classInfo['props'].length>0) {
            return classInfo['props'];
            console.log('returning ', classInfo['props']);
          }else{
            return ['This class has no properties of its own']
          }
        },
        getParentsInfo(list){
          console.log('Getting Parent Class Data...')
          var self= this;
          let res = [];
          for (var i = 0; i < list.length; i++) {
            for (var x = 0; x < self.userSchema.length; x++) {
              console.log(self.userSchema[x].name,list[i])
              if (self.userSchema[x].name === list[i]) {
                res.push(self.userSchema[x])
              }
            }
          }
          self.userSchemaParents = res;
          console.log('Full Parent Info', self.userSchemaParents)
        }
			},
			mounted:function(){
        let context = {{Context}}
        let self= this;
         if ( context ) {
           self.query = context.query;
           if (context.hasOwnProperty('namespace')) {
             // self.namespace = context.namespace.replace(/[0-9]/g, '');;
             self.namespace = context.namespace;
             console.log('namespace', self.namespace)
             console.log('query', self.query)
           }
           self.dataSetURL = localStorage.getItem('datasetDataURL');
           self.checkIfRegistered();
         }

         self.checkUser();

			}
		});


</script>
{% include "footer.html" %}
{% endblock %}
